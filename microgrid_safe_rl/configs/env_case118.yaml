# Case118 Environment Configuration
# Balanced for training: cascades + restoration challenge

network:
  name: "case118"

timing:
  step_seconds: 5.0
  max_steps: 100           # INCREASED: More time for restoration
  pf_failure_patience: 6   # INCREASED: Allow more PF attempts

voltage_limits: [0.95, 1.05]

# ==== DER UNAVAILABILITY ====
der_unavailability:
  enabled: true
  p_deficit_frac: [0.05, 0.10]    
  random_outage_prob: 0.10        
  max_disabled: 1
  max_der_size_mw: 5000.0
  scaling_range: [0.8, 1.2]      
  protect_slack: true
  protect_sgen_on_slack_bus: true

# ==== CASCADE ====
cascade:
  enabled: false
  
  seed:
    n_seeds: 1
    step_window_frac: [0.10, 0.20]  # Later in episode (more stable start)
    exclude_bridges: true            # CHANGED: Protect bridges initially
  
  # Gate parameters
  overload_min_pct: 4.0
  min_hold_steps: 2
  hysteresis_drop: 3.0
  
  # Probability model
  lambda0: 3.0
  rho0: 0.0
  alpha: 1.0
  betaV: 0.4
  zone_boost: 2.5
  d0: 4.0
  
  # Cascade size 
  per_wave_max: 1      
  max_additional: 3      
  min_gap_steps: 2
  
  hop_limit: 2
  neighbor_sample_k: 50
  exclude_bridges: true
  
  prob_loading_map:
    - [4.5, 1.5]
    - [5.5, 2.0]
    - [7.0, 2.5]
    - [8.5, 3.0]

# ==== STRESS - LESS AGGRESSIVE ====
stress:
  local_on_fault:
    enabled: false
    on_every_trip: false
    hops: 1
    duration_steps: 25       
    accumulate: true
    gate_margin_pct: 1.0
  
  global:
    load_scale_p: 1.0
    line_rating_scale: 1.0

# ==== REWARD - EMPHASIZE RESTORATION ====
reward_weights:
  tier1: 15.0                  # INCREASED: Critical loads more important
  tier2: 4.0
  tier3: 0.1
  volt_violation: -3.0         # REDUCED: Less penalty during restoration
  thermal_violation: -2.0      # REDUCED: Allow temporary overloads
  switch_cost: -0.05           # REDUCED: Encourage more switching
  restore_tier1_delta: 12.0    # INCREASED: Big reward for restoring critical
  pf_failure: -40.0            # REDUCED: Less harsh
  bound_violation: -500.0       # REDUCED: Less harsh

# ==== SAFETY ====
safety:
  max_closed_ties: 2           # INCREASED: Allow 2 ties (more flexibility)
  voltage_margin_pu: 0.03      # INCREASED: More tolerance
  loading_margin_pct: 15.0     # INCREASED: More tolerance
  per_step_switch_budget: 2
  min_dwell_steps: 1           # REDUCED: Faster response

# ==== CONTROLS ====
controls:
  allow_switching: true
  allow_tie_closure: true
  allow_load_shedding: false
  allow_generation_control: false
  allow_storage_control: false

enable_setpoint_shedding: true

observation:
  telemetry_latency_steps: 0
  include_async_masks: false
  add_measurement_noise: false